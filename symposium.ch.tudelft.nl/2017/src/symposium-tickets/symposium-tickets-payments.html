<html><head><link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html"></head><body><dom-module id="symposium-tickets-payments"><template><style></style><iron-ajax id="products" url="https://ch.tudelft.nl/payments/api/products/SYMPOSIUM/2016" on-response="onProducts" on-error="onProducts"></iron-ajax><iron-ajax id="tryOrder" url="https://ch.tudelft.nl/payments/api/orders" content-type="application/json" method="POST" on-response="onOrder" on-error="onOrder"></iron-ajax></template><script>'use strict';(function(){Polymer({is:'symposium-tickets-payments',properties:{tickets:{type:Object,notify:!0}},attached:function(){this.$.products.generateRequest()},onProducts:function(a){a.detail.succeeded?this.tickets=a.detail.response:console.log('Unable to get tickets.')},pay:function(a,b){if(!this.tickets)return void this.fire('payments-failed');var c=this.tickets.find(function(d){return d.name===b});return this.$.tryOrder.body={productKeys:[c.key],name:a.name,email:a.email,returnUrl:window.location.origin+'/2017/thank-you'},this.$.tryOrder.generateRequest(),new Promise(function(d){this._resolvePromise=d}.bind(this))},onOrder:function(a){this._resolvePromise(a.detail.response)}})})();</script></dom-module></body></html>