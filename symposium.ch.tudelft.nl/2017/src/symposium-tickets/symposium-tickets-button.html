<html><head><link rel="import" href="../../bower_components/polymer/polymer.html"><link rel="import" href="./symposium-tickets-firebase.html"><link rel="import" href="./symposium-tickets-payments.html"></head><body><dom-module id="symposium-tickets-button"><template><style>:host{display:block;}section{width:80%;text-align:center;}button{margin-top:8px;padding:8px;width:100%;font-size:16px;font-weight:600;background-color:#231657;color:white;border:none;border-radius:4px;box-shadow:0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);}#errorMessage{display:none;color:red;}</style><section><symposium-tickets-firebase id="firebase"></symposium-tickets-firebase><symposium-tickets-payments id="payments" on-payments-failed="showPaymentsError"></symposium-tickets-payments><span id="errorMessage">Select a ticket and fill in all fields.</span> <button id="button" on-tap="pay">Buy!</button></section></template><script>'use strict';(function(){Polymer({is:'symposium-tickets-button',properties:{_user:Object},attached:function(){this.$.firebase.addEventListener('anonymous-login',function(a){this._user=a.detail}.bind(this))},pay:function(){this._user?this._payWithPayments():(this.$.firebase.addEventListener('anonymous-login',function(a){this._user=a.detail,this._payWithPayments()}.bind(this)),this.$.firebase.signInAnonymously())},_payWithPayments:function(){var a=this.parentNode.querySelector('input[name="type"]:checked'),b=this.parentNode.querySelector('input[name="name"]').value,c=this.parentNode.querySelector('input[name="email"]').value;if(!(a&&b&&c))return void(this.$.errorMessage.style.display='block');this.$.button.textContent='Processing...';this.$.payments.pay({name:b,email:c},a.value).then(function(f){this.$.firebase.save(b,c,a.value,f.publicReference).then(function(){window.location=f.url}).catch(function(){this.$.button.textContent='Buy!',window.alert('Oops something went wrong. Did you enter all fields and a valid email?')}.bind(this))}.bind(this))},showPaymentsError:function(){this.$.errorMessage.textContent='We were unable to process your request. Please try again later.',this.$.errorMessage.style.display='block',this.$.button.textContent='Processing failed.'}})})();</script></dom-module></body></html>